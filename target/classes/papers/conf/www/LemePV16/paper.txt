A Field Guide to Personalized Reserve Prices

Renato Paes Leme
Google NYC
renatoppl@google.com

Martin Pál
Google NYC
mpal@google.com

Sergei Vassilvitskii
Google NYC
sergeiv@google.com

ABSTRACT
We study the question of setting and testing reserve prices in single item auctions when the bidders are not identical. At a high level, there are two generalizations of the standard second price auction: in the lazy version we first determine the winner, and then apply reserve prices; in the eager version we first discard the bidders not meeting their reserves, and then determine the winner among the rest. We show that the two versions have dramatically different properties: lazy reserves are easy to optimize, and A/B test in production, whereas eager reserves always lead to higher welfare, but their optimization is NP-complete, and naive A/B testing will lead to incorrect conclusions. Despite their different characteristics, we show that the overall revenue for the two scenarios is always within a factor of 2 of each other, even in the presence of correlated bids. Moreover, we prove that the eager auction dominates the lazy auction on revenue whenever the bidders are independent or symmetric. We complement our theoretical results with simulations on real world data that show that even suboptimally set eager reserve prices are preferred from a revenue standpoint.
1. INTRODUCTION
A key part of auctions is setting the minimum price at which the seller is willing to part with the item. The so called reservation, or, reserve, price is critical to maximizing revenue, as proven by Myerson in his Nobel prize winning work [Mye81]. In the online advertising scenario, setting the reserve price is a non-trivial exercise--the auctions are repeated, hence agents may be adapting their behavior to influence the learning [ARS13, MM14, CGM15], only a glimpse into the buyers' valuations is known [DRY15], and there is a heterogeneity in the sophistication level of the bidders. On the other hand, as observed by Celis et al. [CLMN14], many of the auctions have very few bidders (the median number of bidders is six in their dataset),
Copyright is held by the International World Wide Web Conference Committee (IW3C2). IW3C2 reserves the right to provide a hyperlink to the author's site if the Material is used in electronic media. WWW 2016, April 11­15, 2016, Montréal, Québec, Canada. ACM 978-1-4503-4143-1/16/04. http://dx.doi.org/10.1145/2872427.2883071 .

thereby exacerbating the need for good reserve prices to maximize revenue.
The fact that reserve prices are a good idea comes from Myerson's seminal work [Mye81] which shows that if the valuations are drawn independently and identically (iid) from a distribution satisfying a certain regularity assumption, then the optimal auction takes the form of a second price auction with a reserve price. Myerson's result generalizes past the iid setting: if agents are independent but not identical, the optimal auction involves sorting the agents by a function of their bid (called the virtual value) and assigning the item to the agent with largest non-negative virtual value.
In practice, the optimal auction is complicated to implement, since it involves learning the distributions of valuations in a robust enough manner to allow the computation of virtual values. And even if this computation were feasible, in the spirit of Wilson doctrine [Wil85], simple detail-free mechanisms are often preferred in complex environments in order to mitigate the risks introduced by assumptions of the model. In the spirit of designing simpler auctions for the non-iid setting, Hartline and Roughgarden [HR09] show that if players are independent and their distribution obey the monotone hazard rate condition, then there exist a vector of personalized reserve prices that generates revenue which is at least half of the optimal revenue. Both assumptions (independence and monotone-hazard-rate) are necessary for their result.
In this work, we revisit the topic of setting personalized reserve prices in second price auctions from the perspective of a practitioner: How to compute them? How to make sure they are computed correctly? How to apply them in an efficient manner? While asking this question, we avoid (in most of our results) making any assumptions about the shape of the bid distributions.
Evaluation. In practice computing a reserve price that behaves well in offline simulations is only the first part of the process. A successful experimental evaluation is key in proving that assumptions made in theory are reasonable, and do not lead to unintended consequences.
Testing reserve prices is a separate research challenge in and of itself. We distinguish between short term studies, where the goal is to measure the immediate benefit of the reserve prices, and long term studies that intend to capture the strategic interactions between the bidders and auctioneer. Here we focus on the short term studies, and observe that testing personalized reserve prices, even in this, relatively simple, setting, is non-trivial, and can lead to incorrect conclusions.

1093

1.1 Our Contributions
We show that the problem of computing and applying personalized reserve prices is nuanced, and has paradoxical behavior, particularly when testing the efficacy of reserves in an A/B test. Our empirical evaluations show that the paradoxical behavior is not limited to theory, but does occur in practice as well.
We begin by describing two different approaches to applying personalized reserve prices: lazy and eager, and show that while sometimes one approach dominates another on revenue, they are always within a factor of two of each other (Theorem 4.1).
We then identify two mildly restrictive settings (those of symmetric bidders, and independent bidders) and show that in these situations optimal eager reserve prices always yield more revenue (Theorems 4.4 and 4.5).
Turning to computational issues in setting the optimal lazy and eager reserve prices, we show that a simple nearly linear time algorithm can compute the optimal lazy reserves from previous history, while computing the optimal eager reserves is NP-hard (Propositions 5.1 and 5.2).
We show that naive A/B testing of eager reserve prices always leads to a drop in revenue, even when the reserve prices are set correctly! (Theorem 6.1) We observe that lazy reserves do not suffer from this problem, and behave in an intuitive manner.
Finally, we present an empirical evaluation of our findings on real world data, and show that the performance of the algorithms is much better than the large approximation factors guaranteed by the theory (Section 7).

2. PRELIMINARIES

We consider the standard setting of single item auctions.

Let A = {1, 2, . . . , n} be the set of agents interested in the

item. Each agent i has a value vi for the item, and sub-

mits a bid bi to the auctioneer. Given a vector of bids b = (b1, b2, . . . , bn), we denote by b(1) the highest bid, and b(2)

the second highest bid. We will denote by r = (r1, r2, . . . , rn)

the vector of personalized reserve prices.

We assume that the valuation of each agent is drawn inde-

pendently from an unknown distribution with CDF F and

PDF f . To ease the exposition we assume that the dis-

tributions F are regular, in that the virtual value function

(v) = v -

1-F (v) f (v)

is

monotone

non-decreasing.

In the case when all of the distributions are identical and

known to the seller, F1 = F2 = . . . = Fn, Myerson proved

the following characterization of the optimal auction:

1. Collect bids b1, b2, . . . , bn.
2. Discard all bids that are below -1(0).
3. Allocate the item to the agent with the highest bid, and charge her the maximum of -1(0) and b(2).
Note that -1(0) acts as a reserve price for the auction: this is the minimum bid any agent must submit to win, and also acts as a lower bound on the revenue to the seller.
In this work our focus is on the non-identical setting. In this case Myerson proved that the optimal auction is:

1. Collect bids b1, b2, . . . , bn. 2. For each agent, discard bid bi if it is lower than -i 1(0).

3. Allocate the item to the agent with the highest virtual value, i(bi), and charge her the maximum of -i 1(0) and -i 1(j(bj)), where j is the agent with the second highest virtual value.
There are two major differences from the identical setting. First, instead of having a universal reserve price -1(0), each agent now has a personalized reserve price -i 1(0). Second, the winner is determined as the agent whose bid has the highest virtual value, not the one who has the highest bid.
While the first auction is easily implemented in practice, the latter is much more problematic. First, the virtual value functions depend critically on the value distributions, which themselves are not always known and must be estimated. Second, the auction is counterintuitive to outsiders, as the agent with the highest bid does not always win the item.
2.1 Personalized Reserve Prices
To combat the potential bid inversion that comes with ordering by virtual values, Hartline and Roughgarden [HR09] proposed keeping the personalized reserve prices aspect of the optimal auction, but ordering items by bid instead. They show that with monopoly reserves -i 1(0), this auction yields a 2-approximation to the revenue of the optimal auction when agents are independent and follow the monotone hazard rate condition.
This natural approach leads to two possible flavors of second price auctions, which were first introduced by Dhangwatnotai et al. [DRY15]. Informally, in the eager regime, we first discard all of the bids that do not meet their personalized reserve prices and then run the second price auction on the remaining bids. In the lazy regime, we always try to allocate the item to the agent with highest bid. If her bid is below the reserve price the good goes unallocated, otherwise the agent is charged the maximum between her reserve price and the second highest bid. We describe these two auctions more formally in Section 3.
2.2 Estimating Value Distributions
Myerson's theoretical analysis requires us to know the cumulative density function F , as well as the PDF, f , to compute the virtual value function (·). In practice this is a tall order. In the online advertising context, the auctions are repeated, and thus we can observe a number of draws from the distribution. For example, we observe the sequence of bids for agent i: b1i , b2i , b3i , . . ., from which we can compute empirical estimates F^ and f^ for F and f .
In this work we focus on the computational complexity of computing optimal personalized reserve prices from the previous bids. In particular we show that the optimization question for eager and lazy auctions has very different profiles, one being solvable in polynomial time, and the other being NP-complete.
3. LAZY AND EAGER AUCTIONS
Insisting that advertisers are ranked by bid leads to two flavors of second price auctions. As before, let b = (b1, b2, . . . , bn) be the bids submitted to the auctioneer, and assume without loss of generality that b1  b2  b3 . . . bn. Let r = (r1, r2, . . . , rn) be the vector of reserve prices, with reserve price ri applying to bidder i.
Following the work of Dhangwatnotai, Roughgarden and Yan [DRY15], we define second price auctions with lazy and eager reserves.

1094

Lazy Reserves:
· If b1 < r1 then there is no winner and the item goes unsold.
· if b1  r1, allocate the item to bidder 1 and charge her max(r1, b2).
Eager Reserves:
· Let S = {i : bi  ri} be the set of bidders who bid above reserve.
· Let j be bidder with the highest bid in S (ties broken by the original ordering).
· Allocate the item to bidder j and charge her the maximum of her reserve and second highest bid in S: max(rj , maxiS-{j} bi).
Observe that when the reserve prices are identical, r1 = r2 = . . . = rn, then both of these approaches implement the standard second price auction. We denote by RevL(b; r) and RevE(b; r) the revenue obtained by running the lazy and eager auctions on the same set of bids and reserve prices.
Both versions of the auction are incentive compatible and individually rational, since, whenever player i wins with bid bi, she still wins with all bids bi  bi. Moreover, in either case, the payment of i correspond to her critical bid, i.e., the infimum of the bids for which he wins.
3.1 Example
To demonstrate the difference between the two approaches and show why in general the revenues are incomparable, consider the following two examples.
Example 3.1 (Eager Dominates Lazy). Consider an auction with three bidders A, B, and C, who bid 7, 5, and 3 respectively. Suppose the vector of reserve prices is 8, 1 and 2. The auction with lazy reserves tries to allocate the item to A since she has the highest bid. However, since her bid is lower than her reserve price, the item goes unallocated, and the seller collects no revenue. The auction with eager reserves first filters out A, allocates the item to B and collects revenue of 3.
Example 3.2 (Lazy Dominates Eager). Let A, B, and C be the three bidders bidding 7, 5, and 3. Suppose the vector of reserve prices is 2, 6 and 1. The auction with lazy reserves allocates the item to A since her bid is above her reserve and charges her 5 (the second highest bid). On the other hand, the auction with eager reserves first removes B from consideration (since his bid is below reserve). A still wins the item, but is charged only 3.
Intuitively, eager reserve prices lead to higher revenue when the highest bid is priced out; whereas lazy reserve prices lead to higher revenue when the second highest bidder is priced out.
4. COMPARING LAZY AND EAGER RESERVE PRICES
The second price auctions with eager and lazy reserves are identical when all agents are subject to the same reserve price. If the reserve prices are personalized, however, the outcomes of the auctions can be very different. In terms of

welfare, it is easy to see that the auction with eager reserves always dominates the auction with lazy reserves. The auction with lazy reserves allocates the item only if the highest bidder is above her reserve price. In such cases, the auction with eager reserves also allocates the item. This fact alone makes a second price auction with eager reserves more attractive to sellers that care about match rate.
As we saw in examples in Section 3, in general the revenue gains due to lazy and eager reserve prices are incomparable. In this section we provide a tighter characterization, and identify broad classes where one mechanism dominates another.
We begin with Theorem 4.1 and prove that for any (possibly correlated) bid distribution no auction generates more than twice the revenue of the other, and give two examples to show this bound is asymptotically tight.
Then, in Section 4.2 we show that the revenue of the optimal eager mechanism dominates that of the optimal lazy mechanism whenever either (i) the bidders are symmetric (the joint bid distribution doesn't change when bidders are permuted), or, (ii) the bidders' bids are drawn from independent (not necessarily identical) distributions.
Theorem 4.1. Let D be any distribution over bid vectors b. Also, let RevL(b; r) and RevE(b; r) denote the revenue of the lazy and eager auctions under bid vectors b and personalized reserves r. Let:
rL = arg max EbD[RevL(b, r)],
r
rE = arg max EbD[RevL(b, r)].
r
Then
EbD[RevL(b, rL)]  2 · EbD[RevE (b, rE )],
EbD[RevE (b, rE )]  2 · EbD[RevL(b, rL)].
Proof. For the first inequality, consider running the eager second price auction with rL. For any bid vector b, if the highest player is below the reserve then: RevL(b, r) = 0  RevE(b, r). If the highest player is above the reserve and her payment in the lazy auction is her reserve, then both auctions generate the same revenue. The final case is the case where the highest bidder is above the reserve and the payment in the lazy auction is the second highest bid. In this case, the revenue of the eager auction might be lower if the second highest bidder is below her reserve. For that bid vector, however, the revenue of the lazy auction is the second highest bid, which is equal to the revenue of the auction with no reserve prices. Therefore:
RevL(b, rL)  max[RevE(b, rL), RevE(b, 0)]  RevE(b, rL) + RevE(b, 0)
Taking expectations over b we obtain the first inequality:
E[RevL(b, rL)]  E[RevE(b, rL) + RevE(b, 0)]  2 · E[RevE(b, rE)]
For the second inequality, consider running a lazy second price auction with rE. If for any bid vector b, the highest player is above her reserve, the lazy auction is guaranteed to generate more revenue than the eager auction. If not, then the eager auction generates at most revenue equal to the bid

1095

of the second highest bidder (since revenue is dominated by welfare), which is the revenue of the second price auction with no reserves. Therefore:
RevE(b, rE)  max[RevL(b, rE), RevL(b, 0)]  RevL(b, rE) + RevL(b, 0)
We obtain the second inequality by again taking expectations over b:
E[RevE(b, rE)]  E[RevL(b, rE) + RevL(b, 0)]  2 · E[RevL(b, rL)]

4.1 Lower Bound Examples
The following examples complement the bounds in Theorem 4.1. First, we show an example where revenue from the eager mechanism is almost twice the revenue from the best lazy mechanism.

Example 4.2. There is an instance with n bidders with valuations drawn independently from the same distribution, where the best eager mechanism generates 2 - o(1) times more revenue than the best lazy mechanism.
Proof. Consider n identical bidders, with each bidder choosing to bid bi = n with probability 1/n2 and with probability 1 - 1/n2 bidding bi = 1. (Each bid is drawn independently. To break ties, each bid is perturbed by adding a noise term drawn independently from [0, ] for infinitesimally small )).
With probability 1 - 1/n + O(n-2), all bidder valuations will be 1, and with probability 1/n - O(n-2), some bidder will have a valuation of n. Thus, the optimal welfare given these valuations is 2 - O(n-2).
We claim that a lazy pricing mechanism extracts at most 1 revenue. By symmetry each buyer is equally likely to be the winner. Now consider the reserve price for an individual bidder i.

· If ri < 1 + , revenue will be bounded by 1 + unless both bidder i and another bid bid high (probability of O(n-2)), in which case revenue is bounded by n. The expected revenue is then 1 + o(1).
· If ri > 1 + , revenue is only earned if bi = n, and is bounded by n. Since the probability of a high bid is less than n-1, the expected revenue is bounded by 1.

On the other hand, we claim that an eager mechanism can earn 2 - o(1) revenue. This can be done by imposing a high reserve price ri = n for i = 2, . . . , n (all buyers except one) and a low reserve price r1 = 1 on the remaining bidder. With this setup:

· With probability 1/n - o(n-2), one of bidders 2, . . . , n will submit a high bid, generating revenue n - O(1).

· With the remaining probability, the auction is guaranteed to clear because b1  r1 = 1 and will generate at least 1 in revenue.

The

overall

expected

revenue

is

thus

1 n

· (n - o(1)) + (1 -

1 n

)

·

1

=

2

-

o(1).

Next, we show an example where the lazy mechanism generates twice the revenue of the best eager mechanism. This example requires both that bidders are not symmetric, and that their bids are correlated.

Example 4.3. There is an instance with two correlated heterogenous bidders where a lazy mechanism generates 2 -
o(1) times higher revenue than the best eager mechanism.

Proof. Let M be a sufficiently large constant, and consider the following joint distribution of bids of two bidders.

·

With probability

log M M

,

bidder

1

bids 0

while

bidder

2

bids b2 = M .

·

With

probability

1-

log M M

,

first

bidder's

bid

b1

is

drawn

from a truncated equal revenue distribution F (b) =

1-

1 b

for

b



[1, M )

and

F (M )

=

1

and

the

second

bidder's bid is set to b2 = (1 - )b1 for some arbitrarily

small .

Lazy reserve prices r1 = 0, r2 = M extract the full surplus as  0, achieving expected revenue of

log M · M + 1 - log M (1 - )

MM bf (b)db +

M M 1M

= log M + 1 - log M (1 - ) · (log M + 1) M

= (2 - o(1)) log M.

Suppose the eager mechanism imposes reserves of r1 and r2. With probability log M/M the revenue is r2. For the remaining case, we condition on whether the second bidder bid above reserve. In the case b2 < r2, bidder 1 is competing against his reserve price, r1, generating revenue of at most:

r1(1 - F (r1))  r1 1 -

1- 1 r1

= 1.

If, on the other hand, when b2  r2, the total revenue is bounded by:

M
bf (b)db = log M - log r2 = log(M/r2)
r2
Putting these together the overall revenue is at most :

log M r2 M +

1 - log M M

· 1 + log M r2



1

+

r2

log M M

+ log M

- log r2

This function is convex in r2, thus achieving its maximum at the endpoints of the interval. It obtains its maximum value of (1 + o(1)) log M at r2 = 1.

4.2 Restricted Settings
Above we proved that while the revenue from lazy and eager auctions is always within a factor of two of each other, an unconditional bound is impossible in general. Here we consider two restricted settings, first of symmetric bidders, and then of independent bidders. In both cases we show that eager auctions dominate lazy auctions.

Symmetric Bidders. We say that bidders are symmetric (sometimes also called exchangeable) if the bid distribution is invariant under permutations. Formally, for every

1096

permutation  : [n]  [n] let b be the vector (b(1), b(2), . . . , b(n)). A distribution is symmetric if the distribution of b is the same as the distribution of b. Notice that iid implies symmetry, but symmetry is more general-- for example, consider the bid distribution obtained by choosing in each time one buyer at random and letting her bid H and letting every other buyer bid L. The distribution is clearly symmetric, but it is not independent (since there is always exactly one buyer bidding H).
Theorem 4.4. If bidders are symmetric the optimal eager mechanism yields at least as much revenue as the optimal lazy mechanism.
Proof. Proposition 5.1 tells us that the optimal lazy reserve price for bidder i is a function of the joint distribution of winning bids and prices conditioned on bidder i winning. If bidders are symmetric, the optimal lazy reserve prices are the same for all bidders; r1 = r2 = · · · = rn. If all reserve prices are the same, lazy and eager mechanisms behave identically. (It is however possible that a different reserve price vector yields higher revenue for the eager mechanism, as in Example 4.2.)
Independent Bidders. We show that if each bidder draws her value independently, auctions with eager reserves are always at least as good auctions with lazy reserves.
Theorem 4.5. If bidder valuations are drawn independently (not necessarily from identical distributions), the optimal eager mechanism yields at least as much revenue as the optimal lazy mechanism.
To prove the theorem we will exhibit a method that, given any vector r of lazy reserve prices, produces a vector rE such that E[RevE(b; rE)]  E[RevL(b; r)]. The construction will rely heavily on the independence of the bids. A key concept in the proof is that of trimmed distributions:
Definition 4.6 (trim). Let X be a non-negative random variable distributed according to some distribution D, and a real number r  0. We use trim(D) to denote the distribution of the random variable X = X · 1{X  r}, i.e.. random variable that is equal to X if X  R and is zero if X < r.
This definition allows us to define the main lemma. In the following proofs, we will abbreviate EbD[Rev(b, r)] by Rev(D, r).
Lemma 4.7. Given independent bid distributions Di, D = D1 ×. . . Dn and a reserve price vector r, there exists a vector of reserve prices r such that:
RevL(D, r)  RevL(D , r )
where D = D1 × . . . × Dn and Di = trim(Di; ri).
First we show how to use Lemma 4.7 to prove Theorem 4.5:
Proof of Theorem 4.5. Let r and D be as in Lemma 4.7. Notice that for b  D , Pr[0 < bi < ri] = 0. Since a bidder is never blocked by the reserve, the revenue in both the eager and lazy auctions is the maximum of the second highest bid and the reserve of the highest bidder. This implies that RevE(D , r ) = RevL(D , r ). Since D

stochastically dominates D , there is a distribution on pairs of vectors (b , b) such that the marginals are D and D and bi  bi for all i for every realization of the random variables. Hence, RevE(b ; r )]  RevE(b; r ). Taking expectations we conclude that
RevE(D , r )  RevE(D, r ).
Putting this together with the inequality from Lemma 4.7:
RevL(D, r)  RevL(D , r ) = RevE(D , r )  RevE(D, r )

Now, all is left to do is to prove Lemma 4.7:
Proof of Lemma 4.7. Assume that the bidders are sorted such that r1  r2  . . .  rn. We will define an algorithmic procedure that iterates through bidders 1 to n and at each iteration i, trims the distribution of the i-th bidder and possibly increases the reserves of agents j > i. It is useful to think of r and D = D1 × . . . × Dn as variables that are updated in the course of the procedure.
The procedure will keep the following invariants: (i) RevL(D, r) cannot decrease; (ii) for all bidders already processed, their distribution is trimmed at their reserve, i.e., Pr[0 < bi < ri] = 0. (iii) the reserve prices will continue to be sorted.
Now, we are ready to describe each iteration. When we process bidder i, we perform the following procedure:

Choose x < ri such that: ED[RevL(b; r)|bi = x]  ED[RevL(b; r)|bi < ri]
Set Di = trim(Di, ri) and rj = max(rj, x) for j > i.

Clearly we maintain invariants (ii) and (iii). Now, we

only need to argue that invariant (i) is also maintained. It

is convenient to write RevL(b, r) =

j

j
RevL

(b,

r)

where

RevjL(b, r) is the revenue obtained from bidder j. First notice that ED[ReviL(b; r)] = ED [ReviL(b; r )] since

the lazy auction just extracts revenue from i when she is

the highest bidder and above her reserve (and those events

are unaffected by trimming). Also, in the lazy auction, the

reserves on bidders other than the highest bidder do not

affect the outcome. For all other j = i, notice that ED[RevjL(b; r)|bi  ri] =
ED [RevjL(b; r )|bi  ri]. Conditioned on bi > ri the only
thing changing in the two scenarios is that the reserve price

of j is now rj = max(rj, x); since x < ri, it cannot be binding as bidder i is bidding bi > ri. (Notice that for

bidders j < i, their reserve price was already at least ri, so

rj = rj = max(rj, x) since x < ri < rj.) Finally, ED [RevjL(b; r )|bi < ri] = ED[RevjL(b; r)|bi =
x], since in the first case i must be bidding zero and j is

subject to reserve rj = max(rj, x), but this reserve can be

implemented by having i bid x.

1097

Combining all of the expressions, we get:
ED [RevL(b, r )] = ED [ReviL(b, r )]
+ ED [RevjL(b, r )|bi  ri] Pr(bi  ri)
j=i
+ ED [RevjL(b, r )|bi < ri] Pr(bi < ri)
j=i
= ED[ReviL(b, r)] + ED[RevjL(b, r)|bi  ri] Pr(bi  ri)
j=i
+ ED[RevjL(b, r)|bi = x] Pr(bi < ri)
j=i
Since ED[ReviL(b; r)|bi < ri] = 0, x was picked such that
ED[RevjL(b; r)|bi = x]  ED[RevjL(b; r)|bi < ri]
j=i j=i
Plugging this into the last expression, we get that:
ED [RevL(b, r )]  ED[RevL(b, r)]

5. COMPUTING OPTIMAL RESERVES
In this section we investigate the computational complexity of computing the optimum reserve prices in the eager and lazy settings. We assume that the input to the problem is given as a set of bids submitted to previous auctions. Since the number of auctions run daily is extremely large, it is important for this procedure to be linear, or nearly linear in the size of the input.
We prove that from a computational perspective, lazy and eager auctions are vastly different. Computing the optimal vector of lazy reserves rL can be done in linear time. On the other hand, computing the optimal vector of eager reserves rE is NP-hard.

Proposition 5.1. The optimal vector of lazy reserves rL can be computed in nearly linear time in the size of input
logs.

Proof. Given bids {bi,t}, for each query t, let wt correspond to the agent that would win if no reserve prices were set. For any given vector of reserves r, either wt wins query t or no agent wins. Let Qi be the queries for which wt = i. Then we can write the revenue for the vector r of reserves as:

RevL(b; r) =

1{b(t1)  ri} · max(ri, b(t2))

i tQi

where b(t1) b(t2) are respectively the highest and second highest bid for query t. The previous expression shows that for
lazy reserves, the problem of computing reserve prices can
be decoupled for every i. Also, the optimal reserve price should be of the form b(t2) or b(t1) for some t. If not, we can increase it to the next point and the revenue can only
increase.
This observation gives an algorithm for computing the optimal vector of reserves with running time O( i |Qi|2). In order to turn it into a nearly linear time algorithm, notice

that if we sort the bids appropriately, we can compute the revenue for setting each ri = b(t1) and ri = b(t2) in constant time.
In order to do so, construct an array with all the bids b(t1) and b(t2) for t  Qi and annotate each entry of weather it is a highest bid or a second highest bid. If ni = |Qi|, this is an array of 2ni numbers. Sort the array by bids in increasing order, which takes O(ni log ni), and call its elements r1  r2  . . . r2ni . Assume for simplicity that all elements are distinct. Given a certain rj, we can write the revenue associated with it R(rj ) = tQi 1{b(t1)  rj } · max(rj , b(t2)) as rj · kj + sj where sj = tQi b(t2) · 1{rj  b(t2)}.
If we show how to compute (sj+1, kj+1) from (sj , kj ) in constant time, we have a nearly-linear time algorithm. Doing it is easy. This can be done in two cases:
· rj = b(t1) for some t. Therefore increasing the reserve past b(t1) will make query t to be unallocated. All other queries are unaffected. Set kj+1 = kj - 1 and sj+1 = sj .
· rj = b(t2) for some t. Therefore increasing the reserve past b(t2) will cause the reserve price to bind for query t, instead of the second highest bid. Update: kj+1 = kj + 1, sj+1 = sj - rj .
Since we can reconstruct the revenue for each value in the array, we can choose the optimal vector of reserves in time O( i |Qi|·log |Qi|). It is not hard to see that this algorithm still works if values of the array are repeated.
Proposition 5.2. Computing the optimal vector of eager reserves r given the bids from a set of previous auctions is NP-hard.
Proof. We give a reduction to the independent set problem. Let L and H be constants that we will chose later. Given a graph G = (V, E), we map the independent set problem on this graph to the following instance of the reserve price problem with eager reserves: consider |V | agents and |E| + |V | queries. For each edge e = (u, v) consider queries where bu = L, bv = L and all other agents bid zero. And for each node u, consider queries with bu = H and all other agents bid zero. We select L and H such that L < H < 2L.
Clearly, for the optimal vector of reserves, ri  {L, H}. Also, notice that in the optimal solution, the set of nodes I = {u  V ; ru = H} must form an independent set. Indeed, if there is an edge e = (u, v) with ru = rv = H, then there is zero revenue from the queries corresponding to edges e. If we switch either u or v to have reserve L, then we gain L revenue from edge e and lose H - L from node u. Since L > H - L, this is a profitable deviation.
The revenue associated with setting u  I to H and other nodes to L is given by
L · (|E| + |V |) + (H - L) · |I|
So the optimal vector of reserve prices would give a solution to the maximum independent set problem.
Combining the proof of Theorem 4.1 and Proposition 5.1 we get a 2-approximation to the optimal revenue obtained by running an eager second price auction.

1098

We remark that the algorithm proposed in Proposition

5.1 is different from the heuristic proposed by Hartline and

Roughgarden in [HR09]: their heuristic consists in choos-

ing the vector of monopoly reserve prices rM such that

riM = arg maxr0

T t=1

r

·

1{bi,t



r}.

They observe that

while this is a very good choice when the valuations are in-

dependent and follow the monotone hazard rate condition,

this can be arbitrarily far from the revenue of the optimal

auction if either condition is violated. We complement the

observation showing that this vector can also be arbitrar-

ily far from the optimal revenue of the second price auction

with personalized reserves (which is a weaker benchmark

than the optimal auction).

Claim 5.3. For every constant C, there is a distribution

of

bids

such

that

Rev(b; rM )



1 C

Rev(b;

r)

for

both

the

eager and lazy auctions.

Proof. Consider 2 bidders and consider a distribution on

bids that sets b1 = b2 = 2k-1

with probability

1 2k

probabil-

ity, for k = 1, . . . , K - 1, and b1 = b2 = 2K-1 + with prob-

ability

2 2K

.

The

monopoly

reserve

prices

are

ruM

=

2K-1 +

generating revenue 1 + · 21-K . The optimal vector of re-

serves is zero for both eager and lazy reserves: Rev(b; 0) = K + · 21-K .

6. A/B TESTING
In the previous sections we described auctions with eager and lazy reserve prices, and compared the differences in welfare, revenue, and computational complexity of the two approaches. The theoretical models are clean and elegant, and allow us to abstractly reason about the benefits of one approach over another; however they do not capture the messy realities of setting reserve prices in practice.
Before releasing a new model into the wild, a key step is measuring the impact of its change on a small sample of traffic. This too is a non-trivial step, and requires a lot of care both in setting up the experiments [KHS07] and effectively measuring long term, as well as, short term impacts [HOT15],
One way to test reserve prices is to partition all of the auctions into treatment and control, and then only apply reserves in treatment scenarios. However, such a test gives a biased estimate of the revenue lift--since the effect on an individual buyer is small (as the test applies only to a small fraction of the auctions), the buyer is unlikely to react strategically, for example changing her bidding behavior, or looking for alternative places to buy the impressions.
A different approach is to partition the bidders into treatment and control groups, and only apply reserve prices to the bidders in treatment. It is easy to see that applying reserve prices to only a fraction of the bidders will reduce the overall revenue gains, however since a single buyer is now subject to reserve prices on all of her auctions, she is more likely to update her behavior in response.
It is natural to expect that applying a vector of optimal reserves to a subset of the buyers would yield an improvement in revenue that would allow us to evaluate the impact of applying reserves to all of the buyers. Counterintuitively, we show that even in the simplest possible setting (iid buyers with regular distributions), applying the Myerson reserve

price to a subset of the bidders is worse than not applying any reserve prices at all! In other words, as we add bidders to the treatment group, the total revenue decreases, and it is only when all of the bidders are treated that we realize the revenue gains. As we show in Section 7, this phenomenon is not a purely theoretical construct, but is also not uncommon in practice.
We state the results formally.

Theorem 6.1. Assume agents are iid with regular distribution F and let RevE(k) be the revenue obtained from applying the Myerson reserve price eagerly to k out of n agents and applying no reserve to the remaining agents. Then:
RevE(0)  RevE(1)  RevE(2)  . . .  RevE(n - 1)
Proof. Since agents are iid we can sample agents according to the following procedure: draw n iid samples from F and take a random assignment from them to agents. This is equivalent to drawing the valuation vi for each agent and then choosing k out of n at random players to apply reserve prices. We will denote by v(t) the t-th largest bid.
We consider two scenarios: (i) the highest bidder is above the reserve. In this case, she will be allocated the good. (ii) the highest bidder is below the reserve. In this case, the agent to whom we allocate the good is the highest agent for whom no reserve price is applied.
Let MaxRt(z1, z2, . . . , zn) be the expected maximum of a uniformly random subset of t elements drawn from {z1, z2, . . . , zn}. Notice that for any vector z, the function MaxRt(z1, z2, . . . , zn) is monotone non-decreasing in t. Second, observe that if zi are drawn iid, then:
E[max{z1, . . . , zt}] = MaxRt(z1, z2, . . . , zn).
For k < n, by the Myerson Lemma:
RevE(k) = E[(v(1)) · 1{v(1)  r}]+
E[MaxRn-k((v1), . . . , (vn))|v(1) < r] · Pr(v(1) < r) ()
We finish by noticing that when vi < r then (vi) < 0. Therefore the second term above is negative and nonincreasing in k by the monotonicity of the MaxR operator. For k = n, however, the second term disappears and we recover the optimal auction.

We now show that the auction with lazy reserve prices does not suffer from this kind of paradoxical behavior.

Theorem 6.2. Assume agents are iid with regular distribution F and let RevL(k) be the revenue obtained from lazily applying the Myerson reserve price to k out of n agents and applying no reserve to the remaining agents. Then

RevL(k)

=

k n

RevL

(n)

+

1

-

k n

RevL(0)

Proof. As in the previous theorem, we sample the agents by drawing n iid samples from F and taking a random as-
signment from them to agents.
In the second price auction with lazy reserves, we will choose the agent with bid v(1) and declare her as the winner if v(1) is at least the reserve price, which is r with probability
k/n and 0 with the remaining probability. By Myerson's
lemma:

RevL(k) = E[(v(1)) · 1{v(1)  r(1)}]

1099

.8

second price

Myerson

.6 12345

Figure 1: RevE(k) in red and RevL(k) in blue for n = 5 agents with iid uniform distributions

where r(t) denotes the personalized reserve of agent with the t-th highest bid. Therefore:

RevL(k)

=

1

-

k n

E[(v(1))] +

1

-

k n

E[(v(1)) · 1{v(1)  r}]

=

1

-

k n

RevL(0) +

1

-

k n

RevL(n)

To better understand the detrimental effect of eager reserve prices, it's useful to write equation ( ) in explicit form so that we can evaluate the impact of applying reserves to a subset of buyers for particular distributions:

Lemma 6.3. In the setting of Theorem 6.1:

1
RevE(k) = (x) · nF (x)n-1f (x)dx

r

- 1{k < n}F n(r)

r

F (x) n-k  (x)dx

0 F (r)

Proof. For the first term, notice that the distribution of v(1) is given by nF (x)n-1f (x) since Pr(v(1)  x) =
Pr(vi  x) = F (x)n. For the second term, since the
agents are iid, the maximum of n-k randomly chosen agents

from among n buyers is identical to the maximum of n - k

buyers. By the principle of deferred decisions, we can first

sample n - k buyers and then draw their values.

Since in the second expression we condition their value to

be at most r, we can simply compute the maximum over

n - k buyers with density f (x)/F (r) for 0  x  r. By

the same argument as before the density of the maximum is

(n - k) ·

f (x) F (r)

·

F (x) F (r)

n-k-1
. Using this fact, We can write

the second term as:

F (r)n ·

r (n - k) · f (x) ·

F (x) n-k-1 (x)dx

0 F (r) F (r)

= 1{k < n} · F n(r) (x) · F (x) n-k r

F (r)

0

-

r F (x) n-k  (x)dx

0 F (r)

= -1{k < n} · F n(r)

r

F (x) n-k  (x)dx

0 F (r)

6.1 Case study: Uniform distribution
To get some intuition about Theorem 6.1 we look at the setting with n iid bidders distributed according to the [0, 1]uniform distribution, for which (x) = 2x - 1 and r = 1/2:

1
RevE(k) = (2x - 1)nxn-1dx
1/2

- 1{k < n} ·

1

n
·

1/2
(2x)n-k · 2dx

20

= n + 2-n - 1 - 1{k < n} · 2-n

n+1

n-k+1

In Figure 5 we plot the revenue values for RevE(k) and RevL(k) with n = 5.

7. EXPERIMENTAL RESULTS
In the previous sections we discussed versions of the second price auction with personalized reserve prices: the eager (E) and lazy (L) auction, and proved that while the two notions of reserve prices are incomparable, eager reserves dominate lazy reserve, except for non-identical and nonindependent settings, and in all of the settings total revenue of one is always within a factor of two of another. Further, we showed that applying the eager reserve prices to a subset of the bidders is non monotonic, and applying reserves to more bidders may (in theory) lead to lower revenues. In this section we validate these findings by simulating the effect of reserve prices on real world data.
Data. We collect bids sent to a large advertising exchange over the course of part of a day, and then restrict our attention to five ad slots with the highest traffic volume. Each of the ad slots has the bids submitted for hundreds of thousands of auctions. We report the results for each of the ad slots individually.
7.1 Non-monotonicity
Recall that in Section 6 we considered the standard setting where each bidder i draws an independent bid from bid distribution Fi. In the case of eager reserve prices, applying reserves to only a subset of the bidders leads to a decrease in the overall revenue to the auctioneer.
In this section we show that this scenario is not restricted to theory. We consider a set of auctions and compute the optimal lazy reserve price for each bidder. We then apply this reserve price in both lazy and eager fashions to a subset

1100

revenue increase (normalized)

lazy auction eager auction

85% percentage of reserves applied 98%
Figure 2: Revenue gain obtained by applying the optimal lazy reserve prices to a percentage of the buyers in the auction. Note that the revenue of the lazy auction is monotone non-decreasing, while the eager auction doesn't have this property.

of the bidders and plot the overall revenue. The results are shown in Figure 6.1.
We confirm our theoretical findings: while the revenue in the auction with the lazy reserve pricing strategy is monotonically increasing in the number of bidders subject to the reserve, the same cannot be said for the greedy reserve pricing strategy. The overall trend is positive, but it is non monotonic, and at times increasing the number of bidders subject to the optimal reserve price decreases the overall revenue.
7.2 Revenue Gains
Our second set of experiments addresses the question whether eager or lazy reserve prices lead to higher revenues in practice. For the best comparison, we simulate the auctions under both lazy and eager strategies while applying the optimal lazy reserve prices rL (see Proposition 5.1) and the monopoly reserve prices rM (see the discussion following the proof of Proposition 5.2).
We compute the revenue lifts due to personalized reserves under four strategies:
L(rL) = E[RevL(b; rL)] - E[Rev(b; 0)]
E(rL) = E[RevE(b; rL)] - E[Rev(b; 0)]
L(rM ) = E[RevL(b; rM )] - E[Rev(b; 0)]
E(rM ) = E[RevE(b; rM )] - E[Rev(b; 0)]
where the expectation E[·] denotes the average over all historical queries.
We normalize the lifts by setting the revenue of the lazy reserve auction with optimally set reserve prices to 1 (L(rL) = 1 ), and report multiplicative improvement over this setting.
Table 1 shows that the eager auction outperforms the lazy auction in practice both when the optimal lazy reserves are used and when monopoly reserves are used. We also observe that there is no clear winner between using optimal lazy

Table 1: Revenue Lift Comparison. The units are normalized so that L(rL) = 1

E (rL) 1.13204 1.24867 1.16233 1.19286 1.14805

L(rM ) 0.892116 0.958164 0.942408 0.886347 0.942208

E (rM ) 1.18965 1.28977 1.09623 1.11872 1.08097

reserves or monopoly reserves in the eager auction. For 3 out of 5 slots, the vector of optimal lazy reserves outperforms the monopoly reserves. In practice one may want to start with any of those two vectors and perform local updates to improve the performance of the eager auction.
Another axis along which it makes sense to compare the eager and lazy auctions is the welfare loss of the allocation, i.e., how much welfare is lost due to the application of reserve prices. If WL(b; r) and WE(b; r) are respectively the welfare of the lazy and eager auctions when reserve price r are applied, we define the quantities:
~ L(rL) = E[W(b; 0)] - E[WL(b; rL)]
~ E(rL) = E[W(b; 0)] - E[WE(b; rL)]
~ L(rM ) = E[W(b; 0)] - E[WL(b; rM )]
~ E(rM ) = E[W(b; 0)] - E[WE(b; rM )]
which are the analogues for social welfare of the quantities described in Table 1.
As expected, Table 2 shows that the welfare loss in the eager auction is larger than the welfare loss in the lazy auction. Similarly to what occurs for revenue, there is no clear winner between the optimal lazy reserves and the monopoly reserves for the eager auction.

1101

Table 2: Welfare Loss Comparison. The units are normalized so that ~ L(rL) = 1

~ E (rL) 0.689856 0.70264 0.602512 0.616777 0.636252

~ L(rM ) 1.34808 1.16671
1.046 1.0458 0.995548

~ E (rM ) 0.896388 0.814005 0.695923 0.647172 0.671452

8. CONCLUSION
The results in this work follow two major themes. The first lies in devising methods for testing new strategies, be they reserve prices, bidding agents, or mechanisms, in competitive environments [CHN14]. As we saw in Section 6 these can have counterintuitive effects, and robust experimental design and analysis is required for making correct decisions.
The second is in foregoing the assumption that bidders' value distributions are known and investigating the computational complexity of optimizing from previously observed data. Whether designing new mechanisms in these environments [CR14], understanding the amount of past data needed [MR15], or, providing approximation algorithms, as we do in this work, this is a rich and exciting open area.

9. REFERENCES

[ARS13]

Kareem Amin, Afshin Rostamizadeh, and Umar Syed. Learning prices for repeated auctions with strategic buyers. In Advances in Neural Information Processing Systems 26: 27th Annual Conference on Neural Information Processing Systems 2013. Proceedings of a meeting held December 5-8, 2013, Lake Tahoe, Nevada, United States., pages 1169­1177, 2013.

[CGM15]

Nicolo` Cesa-Bianchi, Claudio Gentile, and Yishay Mansour. Regret minimization for reserve prices in second-price auctions. IEEE Transactions on Information Theory, 61(1):549­564, 2015.

[CHN14]

Shuchi Chawla, Jason Hartline, and Denis Nekipelov. Mechanism design for data science. In Proceedings of the Fifteenth ACM Conference on Economics and Computation, EC '14, pages 711­712, New York, NY, USA, 2014. ACM.

[CLMN14] L. Elisa Celis, Gregory Lewis, Markus M. Mobius, and Hamid Nazerzadeh. Buy-it-now or take-a-chance: Price discrimination through randomized auctions. Management Science, 60(12):2927­2948, 2014.

[CR14] [DRY15] [HOT15] [HR09] [KHS07]
[MM14]
[MR15] [Mye81] [Wil85]

Richard Cole and Tim Roughgarden. The sample complexity of revenue maximization. In Symposium on Theory of Computing, STOC 2014, New York, NY, USA, May 31 - June 03, 2014, pages 243­252, 2014.
Peerapong Dhangwatnotai, Tim Roughgarden, and Qiqi Yan. Revenue maximization with a single sample. Games and Economic Behavior, 91:318­333, 2015.
Henning Hohnhold, Deirdre O'Brien, and Diane Tang. Focusing on the long-term: It's good for users and business. In Proceedings of the 21th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining, KDD '15, pages 1849­1858, New York, NY, USA, 2015. ACM.
Jason D. Hartline and Tim Roughgarden. Simple versus optimal mechanisms. In Proceedings 10th ACM Conference on Electronic Commerce (EC-2009), Stanford, California, USA, July 6­10, 2009, pages 225­234, 2009.
Ron Kohavi, Randal M. Henne, and Dan Sommerfield. Practical guide to controlled experiments on the web: Listen to your customers not to the hippo. In Proceedings of the 13th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining, KDD '07, pages 959­967, New York, NY, USA, 2007. ACM.
Mehryar Mohri and Andres Mun~oz Medina. Optimal regret minimization in posted-price auctions with strategic buyers. In Advances in Neural Information Processing Systems 27: Annual Conference on Neural Information Processing Systems 2014, December 8-13 2014, Montreal, Quebec, Canada, pages 1871­1879, 2014.
Jamie H Morgenstern and Tim Roughgarden. On the pseudo-dimension of nearly optimal auctions. In C. Cortes, N.D. Lawrence, D.D. Lee, M. Sugiyama, and R. Garnett, editors, Advances in Neural Information Processing Systems 28, pages 136­144. Curran Associates, Inc., 2015.
R. Myerson. Optimal auction design. Mathematics of Operations Research, 6(1):58­73, 1981.
R. Wilson. Game-Theoretic Analysis of Trading Processes. Defense Technical Information Center, 1985.

1102

